<div class="col-12">
  <nb-card>
    <nb-tabset fullWidth>
      <nb-tab tabTitle="Ajout d'une nouvelle liste de diffusion">
        <br>
        <br>
        <nb-card class="col-md-12 col-lg-12 col-xxxl-12">
          <nb-card-body>
            <form #form="ngForm" (ngSubmit)="Ajout(form)">
              <div class="row">
                <div class="col-sm-12">
                  <div class="form-group">
                    <label for="inputFirstName" class="label">Libellé de la Liste de Diffusion</label>
                    <input [(ngModel)]="liste.Titre" nbInput placeholder="Entrer le titre de la diffusion " fullWidth
                      #nameInput="ngModel" name="Titre" type="text" required minlength="2" maxlength="50">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-12">
                  <div class="form-group">
                    <label for="inputLastName" class="label">Niveau de visibilté</label>
                    <select class="form-control" name="pays" id="pays" [(ngModel)]="liste.IdNiveauVisibilite"
                      name="NiveauDeVisibilite">
                      <option value="" disabled selected>Veuillez choisir le niveau de visiblité</option>
                      <option *ngFor="let ndvl of nv" [value]="ndvl.id">
                        {{ndvl.libelle}}
                      </option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="row">
                <br>
                <div class="col-sm-12">
                  <div class="form-group">
                    <label for="inputFirstName" class="label">Liste des listes de diffusion</label>
                    <ng-select bindLabel="name" placeholder="Séléctionner les contacts" appendTo="body" multiple="true"
                      [searchable]="true" [clearable]="true" required [(ngModel)]="selected" name="selected">
                      <ng-option [value]="contacts.id" *ngFor="let contacts of contacts">
                        {{contacts.nom}} {{contacts.prenom}}
                      </ng-option>
                    </ng-select>
                  </div>
                </div>
              </div>

              <div class="form-group row">
                <div class="offset-sm-3 col-sm-9">
                  <br>
                  <button type="submit" nbButton status="success" style="float: right;" [disabled]="!form.valid"><i
                      class="fa fa-save" aria-hidden="true"></i>&nbsp;Enregistrer</button>
                </div>
              </div>
            </form>
          </nb-card-body>
        </nb-card>
      </nb-tab>



      <nb-tab tabTitle="Liste des catégories">
        <nb-card>
          <nb-card-header style="text-align: center;">
            <div class="row">
              <div class="form-group col-md-3">
                <input type="text" class="form-control" placeholder="Filtrer votre recherche"
                  [(ngModel)]="searchedKeyword">
              </div>
              <div class="form-group col col-lg-6">
                <b> Liste des diffusions</b>
              </div>
              <div class="form-group col-md-3">
                <a routerLink="/pages/liste_de_diffusion/add"> <button type="submit" nbButton status="success"
                    style="float: right;"><i class="fa fa-plus" aria-hidden="true"></i>&nbsp;</button></a>
              </div>
            </div>
          </nb-card-header>

          <nb-card-body>
            <table class='table table-bordered'>
              <thead style='background-color: #2d8ac7'>
                <tr>
                  <th>#</th>
                  <th style="text-align: center;">Titre</th>
                  <th style="text-align: center;">Référence </th>
                  <th style="text-align: center;">Statut</th>
                  <th style="text-align: center;">Liste des contacts</th>
                  <th style="text-align: center;">Actions</th>
                </tr>
              </thead>
              <tbody style='background-color:white'>
                <tr
                  *ngFor="let g of listes | filter:searchedKeyword | paginate:{ itemsPerPage:10,currentPage:p};let i =index">
                  <th scope='row'>{{i+1}}</th>
                  <td style="text-align: center;">{{g.titre}}</td>
                  <td style="text-align: center;">{{g.reference}}</td>
                  <td style="text-align: center;" *ngIf="g.etat===true"><button type="button" (click)="open(g.id)"
                      class="btn btn-success" data-bs-toggle="modal" data-bs-target="#changeetat">
                      <span class="glyphicon glyphicon-search"></span><i class="fa fa-check" aria-hidden="true"></i>
                      Actif
                    </button></td>
                  <td style="text-align: center;" *ngIf="g.etat===false"><button type="button" (click)="open(g.id)"
                      class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#changeetat">
                      <span class="glyphicon glyphicon-search"></span><i class="fa fa-ban" aria-hidden="true"></i>
                      Inactif
                    </button></td>
                  <td style="text-align: center;"><button nbButton status="success" (click)="listContact(g.id)"
                      data-bs-toggle="modal" data-bs-target="#canaux">
                      <span class="glyphicon glyphicon-search"></span><i class="fa fa-users"
                        aria-hidden="true"></i>&nbsp;
                      Liste des contacts
                    </button></td>
                  <td style="text-align: center;">
                    <div class="btn-group mr-2" role="group" aria-label="First group">
                      <button (click)="open(g.id)" nbButton status="danger" data-bs-toggle="modal"
                        data-bs-target="#delete"><i class="fa fa-trash" aria-hidden="true"></i> </button>&nbsp;
                    </div>

                    <div class="btn-group mr-2" role="group" aria-label="Second group">
                      <button nbButton (click)="open(g.id)" status="warning" data-bs-toggle="modal"
                        data-bs-target="#exampleModal"><i class="fa fa-edit" aria-hidden="true"></i> </button>&nbsp;
                    </div>

                    <div class="btn-group mr-2" role="group" aria-label="Third group">
                      <button nbButton (click)="open(g.id)" status="success" data-bs-toggle="modal"
                        data-bs-target="#exampleMod"><i class="fa fa-eye" aria-hidden="true"></i> </button>
                    </div>
                  </td>

                </tr>
              <tbody>

            </table>
            <pagination-controls (pageChange)="p= $event"></pagination-controls>

          </nb-card-body>
        </nb-card>
        <div class="modal modal-danger fade" id="changeetat" tabindex="-1" aria-labelledby="exampleModalLabel"
          aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title text-center" id="exampleModalLabel" style="text-align: center;">Bloquer /
                  Débloquer utilisateur
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <p class="text-center">
                  <strong>Voulez vous débloquer/bloquer la liste de ? {{dataliste?.titre}}</strong>
                </p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Annuler</button>
                <button type="button" class="btn btn-success" data-bs-dismiss="modal"
                  (click)="changeEtat(dataliste?.id)">Valider</button>
              </div>
            </div>
          </div>
        </div>
        <div class="modal modal-danger fade" id="delete" tabindex="-1" aria-labelledby="exampleModalLabel"
          aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title text-center" id="exampleModalLabel" style="text-align: center;">Suppression
                  utilisateur
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <p class="text-center">
                  <strong>Vous voulez vraiment supprimer la liste de diffusion {{dataliste?.titre}}</strong>
                </p>
                <p>
                  Toutes les informations associées à cette liste de diffusion seront supprimées définitivement.
                  <span class="text-danger">Cette opération ne peut pas être annulée.</span>
                </p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Annuler</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal"
                  (click)="supprimeruser(dataliste?.id)">Ok, Supprimer</button>
              </div>
            </div>
          </div>
        </div>
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modification de la liste {{dataliste?.titre}}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form #form="ngForm">
                  <div class="modal-body">
                    <div class="row">
                      <div class="col-sm-6">
                        <div class="form-group">
                          <label for="inputFirstName" class="label">Titre</label>
                          <input nbInput fullWidth [(ngModel)]="listeE.Titre" #nameInput="ngModel" name="Titre"
                            type="text" required minlength="2" maxlength="50" value="{{listeE?.Titre}}">
                        </div>
                      </div>
                      <div class="col-sm-6">


                        <div class="form-group">
                          <label for="inputLastName" class="label">Niveau de visibilté</label>
                          <select class="form-control" name="pays" id="pays" [(ngModel)]="listeE.IdNiveauVisibilite"
                            name="NiveauDeVisibilite">
                            <option *ngIf="listeE.IdNiveauVisibilite==='1'" value="{{listeE.IdNiveauVisibilite}}"
                              disabled selected ngI>Public
                            </option>
                            <option *ngIf="listeE.IdNiveauVisibilite==='2'" value="{{listeE.IdNiveauVisibilite}}"
                              disabled selected ngI>Privé
                            </option>
                            <option *ngIf="listeE.IdNiveauVisibilite==='3'" value="{{listeE.IdNiveauVisibilite}}"
                              disabled selected ngI>Protégé

                            </option>
                            <option *ngFor="let ndvl of nv" [value]="ndvl.id">
                              {{ndvl.libelle}}
                            </option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-warning" data-bs-dismiss="modal"><i
                        class="fas fa-undo"></i>&nbsp;Annuler</button>
                    <button type="submit" class="btn btn-success" data-bs-dismiss="modal"
                      (click)="saveModification(dataliste?.id,form)"><i class="fas fa-edit"></i>&nbsp;Modifier</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        <div class="modal fade" id="exampleMod" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Informations de la liste de Diffusion
                  {{dataliste?.titre}}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <b> Titre :</b> {{dataliste?.titre | uppercase}}<br>
                <b> Code :</b> {{dataliste?.reference}}<br>
                <b *ngIf="dataliste?.etat===true"> Statut :</b> <span *ngIf="dataliste?.etat===true"
                  style="color: green;"> ACTIF</span>
                <b *ngIf="dataliste?.etat===false"> Statut :</b> <span *ngIf="dataliste?.etat===false"
                  style="color: red;"> INACTIF</span>

              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-success" data-bs-dismiss="modal">Fermer</button>
              </div>
            </div>
          </div>
        </div>
      </nb-tab>
    </nb-tabset>
  </nb-card>
</div>